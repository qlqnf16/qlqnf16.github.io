---
layout: post

title: "데드락(Deadlock)"

category: [computer science, os]

date: 2019-10-05 18:35
---

데드락(Deadlock)이란 무엇일까? 데드락을 막는 방법은?

---

**데드락(Deadlock)**이란 서로가 자원을 점유한 상태로 상대방의 자원을 내놓길 기다리며 **무기한 대기 상태**에 빠지는 것을 말한다. 프로세스 A와 B가 있고, 각각 자원 1과 2를 점유하고 있다고 했을 때, 프로세스 A는 자원 2를, B는 자원 1을 요구하는 상태다. 이 상황에서 두 프로세스는 벗어날 수 없는 기다림의 상태에 빠지게 되고, 이를 **교착상태**라고 한다.

![](https://t1.daumcdn.net/cfile/tistory/270DA73358FC58F207)

서로가 길을 막고 있어서 누구도 전진할 수 없고, 차들이 앞뒤로 꽉꽉 차 있어서 후진도 할 수 없는 도로의 교착상태.

PC에서 데드락이 발생한다면 간단하게 껐다 켜서 문제를 해결할 수 있다. 그러나 개인 프로그램이 아니라 한시도 멈춰서는 안되는 프로그램에 데드락이 발생하면 큰 문제를 일으킬 수 있다. 따라서 개발자는 데드락 상태가 발생하지 않도록 프로그래밍해야 한다.

## 데드락 예방법

### 데드락의 발생조건

데드락을 예방하기 위해서는 먼저 데드락이 발생하는 조건을 알아야 한다. 데드락이 발생할 수 있는 **네 가지의 필요조건**이 있다. 이 조건을 모두 만족했을 때, 교착상태에 빠질 수 있다는 것이다.

1. **상호배제**(Mutual Exclusion, MUTEX): 자원의 배타적 점유. 한 프로세스가 자원을 점유하고 있으면, 다른 프로세스는 그 자원에 접근할 수 없음을 의미.
2. **점유와 대기**(Hold and Wait): 프로세스가 자원을 점유한 상태로, 다른 자원을 요구하며 대기하는 상태.
3. **비선점**(No Preemption): 한 프로세스가 자원을 점유하고 있다면, 다른 프로세스가 그 자원을 뺏을 수 없음.
4. **환형대기**(Circular Wait): 프로세스와 자원의 대기 상태가 원형을 유지해, 서로의 요구가 맞물리는 상태.

### 데드락을 처리하는 방법

#### 1. 예방기법

말 그대로 **데드락이 발생하는 일이 없도록** 예방하는 방법이다. 위에 설명된 **데드락의 네가지 발생조건 중 한 가지 이상을 해체**함으로써 데드락을 예방할 수 있다. 네 가지 조건 중 하나라도 만족하지 않으면 데드락이 발생하지 않기 때문이다. **자원의 낭비가 심하다**는 단점이 있다.

- 상호배제: 하나의 자원에 두 개 이상의 프로세스가 접근할 수 있게 하는 것. 그러나 이 방법은 **데이터 동기화 문제**를 발생시킬 수 있기 때문에 <u>사용되지 않는다</u>.
- 점유와 대기: 프로세스가 자원을 일부 점유하고 있는 상황에서 다른 자원을 요구하지 못하도록 하는 것. 하지만 이 경우 자원의 활용률이 떨어지고, **기아상태(starvation)**가 발생할 수 있다는 문제점이 있다.
- 비선점: 한 프로세스가 자원을 점유하고 있을 때 다른 프로세스가 자원을 뺏을 수 있게 하는 것. 그러나 이 방법 또한 **상호배제를 해제하는 것과 비슷한 문제를** 낳을 수 있다. 예를 들어 프린터라는 자원을 선점할 수 있게 한다면, 프로세스A가 요청한 것이 출력되다가 B의 요청이 출력되고 다시 A가 출력되는 일이 일어날 수 있기 때문이다. 따라서 이 방법 또한 거의 <u>사용되지 않는다</u>.
- **환형대기**: 자원에 고유한 번호를 할당하고, 오름차순/내림차순 등 **단방향으로만 자원을 요구**할 수 있게 하는 것. 예방기법 중에서는 가장 좋은 방법이다.

#### 2. 회피기법

교착상태가 발생할 수 있는 상황을 피해가는 방법이다. 자원을 분배하는 방법을 제어함으로써 구현할 수 있다.

회피기법은 자원을 분배하기 전에, **현재 자원이 안전하게 할당되어 있는 상태인지 파악**한다. 여기에서 안전하게 할당된 상태란 교착 상태가 발생할 가능성이 없는 상태를 말한다. 그에 따라 안전 상태에 있으면 자원을 할당하고, 그렇지 않으면 자원 할당을 거부함으로써 교착 상태를 피할 수 있다.

매번 자원을 할당하기 전에 안전상태인지 검사를 해야하므로 **오버헤드가 발생할 수 있다**는 단점이 있다.

#### 3. 발견과 회복

교착상태가 발생하는 것을 막는 대신, **주기적으로 검사**해 교착상태 **발견시 회복**하는 방법. 회복하는 방법으로는 교착 상태를 일으킨 프로세스를 종료하거나, 점유된 자원을 해제하는 것이 있다.

- **프로세스를 종료**하는 방법

  - 교착상태를 일으킨 프로세스를 모두 종료
  - 교착상태가 해결될 때까지 프로세스를 하나씩 종료

- **자원을 선점**하는 방법

  - 교착상태를 일으키고 있는 프로세스를 일시정지하고, 다른 프로세스에게 자원을 넘겨주는 방법

  - 우선순위가 낮거나 수행된 횟수가 적은 프로세스의 자원을 선점하는 방법

교착상태를 회복하는 데에도 큰 비용이 들고, 회복 전에 교착상태 발견을 감지하는 알고리즘 자체도 복잡하기 때문에, **오버헤드가 발생할 수 있다**는 단점이 있다.

#### 참고자료

> - [[운영체제] 데드락, 교착상태 해결 (Dead lock)](https://includestdio.tistory.com/12)
> - [[운영체제] 교착상태 처리방법, 예방법, 해결방안](https://jhnyang.tistory.com/4?category=815411)
